<!DOCTYPE html>
<html lang="en" ng-app="AngularStore">
<head>
	<title>进行中订单</title>
	<script src="/statics/js/header.js"></script>
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body bgcolor="#f0f8ff" id="body">

<div class='navbar-header' id='head1'>
	<a class='navbar-brand'>502汽修厂管理系统</a>
</div>

<!-- 右上区块 -->
<div class='collapse navbar-collapse' id='bs-example-navbar-collapse-1'>
	<ul id='navbar' class='nav navbar-nav navbar-right' >
		<li><a id='text'></a></li>
		<li><a id='register' href='/register' title='注册' style="cursor: pointer">前往注册</a></li>
		<li><a id='login' href='/login' title='登录' style="cursor: pointer">前往登录</a></li>
		<li><a id='logout' title='退出登录' data-toggle='modal' data-target='#log_out' onclick='getUsername()' style="cursor: pointer">退出登录</a></li>
	</ul>
</div>

<!-- 主体部分 -->
<div class='container-fluid'>
	<div class='row'>
		<!--左导航栏-->
		<div class='col-md-2'>
			<div class="list-group">
				<a class="list-group-item list-group-item-info" style="cursor: default">
					个人信息
				</a>
				<a id="user_name" class="list-group-item" style="cursor: default">用户名:18001723206</a>
				<a id="user_property" class="list-group-item" style="cursor: default">性　　质:个人</a>
				<a id="user_tel" class="list-group-item" style="cursor: default">联系电话:13472413472</a>
				<a id="user_contact" class="list-group-item" style="cursor: default">联 系 人:Baitian2</a>
				<a id="user_discount" class="list-group-item" style="cursor: default">折扣率:100%</a>
				<a class="list-group-item" data-toggle='modal' data-target='#change_info' onclick='userinfo()' style="cursor: pointer; text-decoration-line: underline">更改个人信息</a>
				<a class='list-group-item' data-toggle='modal' data-target='#change_password' style="cursor: pointer; text-decoration-line: underline">更改密码</a>
			</div>

			<div class='list-group'>
				<a class='list-group-item list-group-item-success' style="cursor: default">
					查看申请详情
				</a>
				<!-- <a class='list-group-item' data-toggle='modal' data-target='#change_password' style="cursor: pointer">更改密码</a> -->
				<!-- <a class='list-group-item' href='/change_userinfo'>个人信息</a> -->
				<a class='list-group-item' href='/u_check_orders_ongoing' style='cursor:pointer; text-decoration-line: underline'>进行中(3)</a>
				<a class='list-group-item' href='/u_check_orders_finished' style='cursor:pointer; text-decoration-line: underline'>已完成</a>
			</div>
		</div>

		<!--右区域-->
		<div class="col-md-10">

			<div class="alert alert-warning alert-dismissible" role="alert">
				<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
				<strong>客户您好!</strong> 您有新的消息需要处理！！！<a onclick="checkNotification()" style="cursor: pointer">立即查看</a>
			</div>
			<div class='col-md-10' id='con'  style='text-align: center'>
				<label style='color: #77bbe2;font-size:50px;'>　　　车辆信息</label>
			</div>

			<div class="table-responsive col-md-12">
				<table class="table  table-bordered table-hover">
					<tr>
						<th width="10%"><h5 style="font-weight: 900;">订单号</h5></th>
						<th width="12%"><h5 style="font-weight: 900;">车架号</h5></th>
						<th width="20%"><h5 style="font-weight: 900;">粗略故障描述</h5></th>
						<th width="40%"><h5 style="font-weight: 900;">详细故障描述</h5></th>
						<th width="10%"><h5 style="font-weight: 900;">预计完成时间</h5></th>
						<th width="8%"><h5 style="font-weight: 900;">维修进度</h5></th>
					</tr>

					<tr ng-repeat="item in list | filter:listfilter">
						<td>00000001</td>
						<td>12345678901234567</td>
						<td>车坏了</td>
						<td>右后轮爆胎</td>
						<td>2022-1-20</td>
						<td>处理中</td>
					</tr>
				</table>


			<div class='row' id="right">
			</div>
		</div>
	</div>
</div>

<!--通知信息框
<div id="alert" style="width: 35%; position: absolute; top: 10%; left: 36%; text-align: center; background-color: white;">
    <div class="modal-dialog modal-content" style="width: 100%;">
        <div class="modal-header">
            <h3 class="modal-title">【通知】您的车辆沪SHU504已被他人绑定</h3>
        </div>
        <h4 class="modal-body" style="text-align: left;">　　尊敬的用户您好，您的车辆沪SHU504已被手机尾号为3472的用户绑定。</h4>
        <h4 class="modal-body" style="text-align: right;">2021-12-30 16:38:26</h4>
        <form class="modal-footer">
            <button class="btn btn-primary" type="submit">已读</button>
            <button class="btn btn-default">暂时忽略</button>
        </form>
    </div>
</div>
-->

<!-- 登出模态框（Modal）-->
<div class='modal fade' id='log_out' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
				<h3 class='modal-title' id='myModalLabel'>您确定要登出当前账号吗？</h3>
				<h4 class='modal-body' id='text1'></h4>
			</div>
			<form class='modal-footer'>
				<button type='submit' value='退出登录' class='btn btn-primary' onclick='logout()'>退出登录</button>
				<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
			</form>
		</div>
	</div>
</div>

<!-- 更改个人信息 -->
<div class='modal fade' id='change_info' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden='true' >&times;</button>
				<h3 class='modal-title' id='changeUserInfo'>更改个人信息</h3>
			</div>
			<div class='modal-body'>
				<img src='/statics/user/真实姓名.png' width='20px' alt="正在加载图片">
				<label for="name" style='font-size:15px;width: 100px;'>姓名：</label>
				<input id='name' type='text' placeholder='请输入姓名'/>
				<br>

				<img src='/statics/user/公司.png' width='20px' alt="正在加载图片">
				<label for="property" style='font-size:15px;width: 100px;'>性质：</label>
				<select id='property'>
					<option value='个人' selected>个人</option>
					<option value='公司'>公司</option>
				</select>
				<br>

				<img src='/statics/user/联系人.png' width='20px' alt="正在加载图片">
				<label for="contact_person" style='font-size:15px;width: 100px;'>联系人：</label>
				<input id='contact_person' type='text' placeholder='请输入联系人'/>
				<br>

				<img src='/statics/user/联系人.png' width='20px' alt="正在加载图片">
				<label for="contact_tel" style='font-size:15px;width: 100px;'>联系电话：</label>
				<input id='contact_tel' type='text' readonly='readonly' value='13472413472' style="color: #9d9d9d"/>
				<br>

				<img src='/statics/user/联系人.png' width='20px' alt="正在加载图片">
				<label for="discount_rate" style='font-size:15px;width: 100px;'>折扣率：</label>
				<input id='discount_rate' type='text' readonly='readonly' value='100%' style="color: #9d9d9d"/>
				<br>

			</div>
			<form class='modal-footer'>
				<label style='font-size:1px;width: 80px;color: red;'>没有再次确认哦，真的</label>
				<button type='button' class='btn btn-primary' onclick='changeinfo()' id='confirmChangeInfo'>确认更改</button>
				<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
			</form>
		</div>
	</div>
</div>

<!-- 更改密码 -->
<div class='modal fade' id='change_password' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true' onkeydown="keychangepassword()">
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button>
				<h3 class='modal-title' id='changePSWD'>更改密码</h3>
			</div>
			<div class='modal-body'>
				<img src='/statics/user/井号.png' width='20px' alt="正在加载图片">
				<label for="oldpswd" style='font-size:15px;width: 80px;'>原密码：</label>
				<input id='oldpswd' type='password' name="oldpswd" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext3'></span> <br></br>

				<img src='/statics/user/车牌.png' width='20px' alt="正在加载图片">
				<label for="pswd" style='font-size:15px;width: 80px;'>密码：</label>
				<input id='pswd' type='password' name="pswd" onchange="checkpwd()" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext4'></span> <br></br>

				<img src='/statics/user/颜色.png' width='20px' alt="正在加载图片">
				<label for="pwdc" style='font-size:15px;width: 80px;'>确认密码：</label>
				<input id='pwdc' type='password' name="pwdc" onchange="checkpwdc()" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext5'></span> <br></br>

				<input type="hidden" id="old_password" name="old_password" />
				<input type="hidden" id="new_password" name="new_password" />
				<form class='modal-footer'>
					<button type='button' class='btn btn-primary' onclick='check()' id='changepasswordbutton'>确认更改</button>
					<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- 返回主页按钮 -->
<div class='col-md-3' >
	<a href="/index">
		<img src="/statics/user/返回主页.png" style='position:fixed;top:70%;right:1%;cursor: pointer' alt="正在加载图片"/>
	</a>
</div>

<script>
	function checkpwd(){
		var check = false;
		var pswd = document.getElementById("pswd").value;
		if(pswd.length < 6){
			document.getElementById("checktext4").innerHTML = " × 不要少于6位";
			check = false;
		}
		else {
			document.getElementById("checktext4").innerHTML = " √";
			check = true;
		}
		return check;
	}
	function checkpwdc() {
		var check = false;
		var password = document.getElementById("pswd").value;
		var pwdc = document.getElementById("pwdc").value;
		if (password !== pwdc) {
			document.getElementById("checktext5").innerHTML = " × 两次输入密码不一致";
			check = false;
		}
		else {
			document.getElementById("checktext5").innerHTML = " √";
			check = true;
		}
		return check;
	}
	function check() {
		if(checkpwd() && checkpwdc()){
			changePswd();
		}
	}
	function keychangepassword(){
		if(event.keyCode === 13){
			document.getElementById('changepasswordbutton').click();
		}
	}

	window.onload= function(){
		getUserName();
		checkGroup();
		checkUser();
		getinfo();
		userInfo();
	}
	function userinfo(){
		axios({
			method : 'get',
			url: "/userinfo"
		})
				.then(function(response){
					var last = response.data;
					document.getElementById("name").value = last.name;
					document.getElementById("property").value = last.property;
					document.getElementById("contact_person").value = last.contact_person;
				})
	}
	function userInfo(){
		axios({
			method : 'get',
			url: "/userinfo"
		})
				.then(function(response){
					var last = response.data;
					document.getElementById("user_name").innerHTML = "用户名：" + last.number;
					document.getElementById("user_property").innerHTML = "性　　质：" + last.property;
					document.getElementById("user_tel").innerHTML = "联系电话：" + last.contact_tel;
					document.getElementById("user_contact").innerHTML = "联 系 人：" + last.contact_person;
					document.getElementById("user_discount").innerHTML = "折扣率：" + last.discount_rate +"%";
				})
	}

</script>

</body>
</html>

