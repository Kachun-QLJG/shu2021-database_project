<!DOCTYPE html>
<html lang="en" ng-app="AngularStore">
<head>
	<title>主页</title>
	<script src="/statics/js/header.js"></script>
	<script src="/statics/js/axios.js"></script>
	<script src="/statics/js/axios.min.js"></script>
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="/statics/js/script.js"></script>
	<style>
		/*web background*/
		.container{
			display:table;
			height:100%;
		}
		.select:hover{
			background-color: #77bbe2;
		}
		/* centered columns styles */
		.row-centered {
			text-align:center;
		}
		.col-centered {
			display:inline-block;
			float:none;
			text-align:left;
			margin-right:-4px;
		}

		/*ul li{*/
		/*	list-style: none;*/

		/*	width:90px;*/

		/*	border: 1px solid #000;*/
		/*}*/

		/*ul{*/
		/*	margin:0;*/
		/*	width: 200px;*/
		/*	list-style: none;*/
		/*	box-sizing: border-box;*/
		/*	padding: 1px;*/
		/*	border: 1px solid grey;*/
		/*	visibility: hidden;*/
		/*}*/

		.middle {float: none;display: inline-block;vertical-align: middle;width: 130%;}
		.outer-col{background-color: #dff0d8;box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;border-radius: 20px;padding: 10px;margin: 1% 3% 1% 2%;}
		.inner-row-1{display: flex;align-items: center;box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;margin: 10px;background-color: white}
		.inner-col-1{display: flex;align-items: center;vertical-align: middle;}
		.inner-row-2{margin: 7px 7px;}
		.inner-button{background-color: #bce8f1;box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px #444;border-radius: 5px;margin-top: 2%;}
		.inner-button a{font-size: 17px;color: black;cursor: pointer;}
		.inner-row-3{box-shadow: inset 1px -1px 1px #444, inset -1px 1px 1px;border-radius: 10px;background-color: white;margin: 7px 7px;}
		.inner-row-3 h4{font-size: 15px;display:inline-block;margin-left: 5%}
		.outer-png{margin-top:12px;margin-left: 12px;}

		.order-form{}
		.order-form th {font-size: 17px;text-align: center!important;vertical-align: middle!important;}
		.order-form th label{font-size: 17px;}
		.order-form td {font-size: 17px;text-align: center!important;vertical-align: middle!important;}
		.order-form td h5{font-size: 17px;}

		#alert div h4{
			line-height: 130%;
		}
		.wcr{color: red}
		.wcg{color: green}

		/*
		.row > div {
			display: inline-block;
			vertical-align: middle;
			float: none;
		}*/
	</style>
	<script type="text/javascript">
		function checkpwd(){
			var check = false;
			var pswd = document.getElementById("pswd").value;
			if(pswd.length < 6){
				document.getElementById("checktext4").innerHTML = " × 不要少于6位";
				check = false;
			}
			else {
				document.getElementById("checktext4").innerHTML = " √";
				check = true;
			}
			return check;
		}
		function checkpwdc() {
			var check = false;
			var password = document.getElementById("pswd").value;
			var pwdc = document.getElementById("pwdc").value;
			if (password !== pwdc) {
				document.getElementById("checktext5").innerHTML = " × 两次输入密码不一致";
				check = false;
			}
			else {
				document.getElementById("checktext5").innerHTML = " √";
				check = true;
			}
			return check;
		}
		function check() {
			if(checkpwd() && checkpwdc()){
				changePswd();
			}
			else if(checkpwd() === false){
				alert("密码不要少于6位！");
			}
			else{
				alert("两次输入的密码不一致！");
			}
		}
		function keychangepassword(){
			if(event.keyCode === 13){
				document.getElementById('changepasswordbutton').click();
			}
		}
		let date = new Date()
		let yyyy = date.getFullYear()
		let MM = (date.getMonth() + 1) < 10 ? ("0" + (date.getMonth() + 1)) : (date.getMonth() + 1)
		let dd = date.getDate() < 10 ? ("0" + date.getDate()) : date.getDate()
		let curDay = yyyy + '-' + MM + '-' + dd ;
		$('.measureDate').val(curDay)
		console.log(date)
	</script>
</head>
<body bgcolor="#f0f8ff" id="body">
<!-- 标题 -->
<div class='navbar-header' id='head1'>
	<a class='navbar-brand'>502汽修厂管理系统</a>
</div>

<!-- 右上区块 -->
<div class='collapse navbar-collapse' id='bs-example-navbar-collapse-1'>
	<ul id='navbar' class='nav navbar-nav navbar-right' >
		<li><a id='text'></a></li>
		<li><a data-target='#log_out' data-toggle='modal' id='logout' onclick='getUsername()' style="cursor: pointer" title='退出登录'>退出登录</a></li>
	</ul>
</div>

<!-- 主体部分 -->
<div class='container-fluid'>
	<div class='row'>
		<!--左导航栏-->
		<div class='col-md-2'>
			<div class="list-group">
				<a class="list-group-item list-group-item-info">
					员工信息
				</a>
				<a id="number" class="list-group-item" style="cursor: default">工　　号：</a>
				<a id="salesman_name" class="list-group-item" style="cursor: default">姓　　名：</a>
				<a class='list-group-item' data-toggle='modal' data-target='#change_password' style="cursor: pointer; text-decoration-line: underline">更改密码</a>
			</div>

<!--			<div class='list-group'>-->
<!--				<a class='list-group-item list-group-item-success'>-->
<!--					查看订单详情-->
<!--				</a>-->
<!--				&lt;!&ndash; <a class='list-group-item' data-toggle='modal' data-target='#change_password' style="cursor: pointer">更改密码</a> &ndash;&gt;-->
<!--				&lt;!&ndash; <a class='list-group-item' href='/change_userinfo'>个人信息</a> &ndash;&gt;-->
<!--&lt;!&ndash;				<a class='list-group-item' data-toggle='modal' data-target='#take_order' style='cursor:pointer; text-decoration-line: underline'>接单</a>&ndash;&gt;-->
<!--				<a class='list-group-item' data-toggle='modal' data-target='#finished_order' style='cursor:pointer; text-decoration-line: underline' onclick="getFinishedAttorneyS()">已完成</a>-->
<!--			</div>-->
		</div>

		<!--右区域-->
		<div class="col-md-10">
			<div id="notification" class="alert alert-warning alert-dismissible" role="alert" style="display: none">
				<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true" data-backdrop="static">&times;</span><span class="sr-only">Close</span></button>
				<strong>业务员您好!</strong> 您有新的消息需要处理！！！<a onclick="checkNotification()" style="cursor: pointer">立即查看</a>
			</div>

			<!--大标题-->
			<div class='col-md-12'  style='text-align: center'>
				<label style='color: #77bbe2;font-size:50px;' >订单详情</label>
			</div>

			<!--折叠组-->
			<div class="panel-group col-md-12" id="accordion">
				<!--折叠组-1-->
				<div class="panel panel-warning">
					<div class="panel-heading">
						<h4 class="panel-title">
							<a id="preBound" data-toggle="collapse" data-parent="#accordion"
							   href="#collapseOne">
								待接订单
							</a>
						</h4>
					</div>
					<div id="collapseOne" class="panel-collapse collapse">
						<table class="table table-bordered table-hover" id="pending_table" style="text-align: center; vertical-align: center">
							<thead>
								<tr  class="order-form">
									<th><label>订单号</label></th>
									<th><label>车牌号</label></th>
									<th><label>车架号</label></th>
									<th><label>车型</label></th>
									<th><label>粗略故障描述</label></th>
									<th><label>接单</label></th>
								</tr>
							</thead>
							<tbody id="pending_table_son">
								<tr class="order-form">
									<td><h5>00000002</h5></td>
									<td><h5>SHU6502</h5></td>
									<td><h5>12345678901234567</h5></td>
									<td><h5>12345678901234567</h5></td>
									<td><h5>110</h5></td>
									<td><a class="btn btn-info btn-md"><span class="glyphicon"></span>接单！！！</a></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>

				<br>

				<!--折叠组-2-->
<!--				<div class="panel panel-info" id="ongoing">-->
<!--					<div class="panel-heading">-->
<!--						<h4 class="panel-title">-->
<!--							<a data-toggle="collapse" data-parent="#accordion"-->
<!--							   href="#collapseTwo">-->
<!--								进行中订单-->
<!--							</a>-->
<!--						</h4>-->
<!--					</div>-->
<!--					<div id="collapseTwo" class="panel-collapse collapse">-->
<!--&lt;!&ndash;						<div id="ongoing_table_father" style="margin: auto;align-items: center; text-align: center; font-size: 17px;left: 10%">&ndash;&gt;-->
<!--						<table id="finished_table" border="1" style="margin: auto; width: 560px; text-align: center; font-size: 17px;">-->
<!--							&lt;!&ndash; 表头 &ndash;&gt;-->
<!--							<tbody>-->
<!--							<tr style="height: 30px">-->
<!--								<th id="number_finished" style="text-align: center; width: 120px">订单号</th>-->
<!--								<th id="vehicle_number_finished" style="text-align: center">车架号</th>-->
<!--								<th id="parts_number_finished" style="text-align: center">粗略故障描述</th>-->
<!--								<th id="parts_name_finished" style="text-align: center">详细故障描述</th>-->
<!--								<th id="parts_count_finished" style="text-align: center">维修完成时间</th>-->
<!--								<th id="finished_detail" style="text-align: center">委托书</th>-->
<!--							</tr>-->
<!--							</tbody>-->
<!--							&lt;!&ndash; 传参处 &ndash;&gt;-->
<!--							<tbody id ="body_second">-->
<!--							<tr>-->
<!--								<td rowspan="2">0000001</td>-->
<!--								<td rowspan="2">12345678901234567</td>-->

<!--								<td>001</td>-->
<!--								<td>轮毂</td>-->
<!--								<td>1</td>-->

<!--								&lt;!&ndash; <td rowspan="2"><a href="/show_pdf?attorney_no=00000002" target="_blank">查看pdf</a></td> &ndash;&gt;-->
<!--								<td rowspan="2"><a data-toggle='modal' data-target='#detail' style="cursor: pointer; text-decoration-line: underline">查看pdf</a></td>-->
<!--							</tr>-->
<!--							<tr>-->
<!--								<td>002</td>-->
<!--								<td>后视镜</td>-->
<!--								<td>2</td>-->
<!--							</tr>-->
<!--							</tbody>-->
<!--						</table>-->
<!--&lt;!&ndash;						</div>&ndash;&gt;-->
<!--					</div>-->
<!--				</div>-->

<!--				<br>-->

				<!--折叠组-2-->
				<div class="panel panel-info">
					<div class="panel-heading">
						<h4 class="panel-title">
							<a id="onBound" data-toggle="collapse" data-parent="#accordion"
							   href="#collapseTwo">
								进行中订单
							</a>
						</h4>
					</div>
					<div id="collapseTwo" class="panel-collapse collapse in">
<!--					<div id="ongoing_table_father" style="margin: auto;align-items: center; text-align: center; font-size: 17px;left: 10%">-->
						<table border="1" class="table table-bordered table-hover" id="ongoing_table"  style="text-align: center; vertical-align: center; font-size: 17px;">
							<!-- 表头 -->
							<thead>
								<tr class="order-form">
									<th id="number_ongoing" >订 单 号</th>
                                    <th>车牌</th>
                                    <th>车架号</th>
									<th id="user_name">车型</th>
                                    <th>粗略故障描述</th>
                                    <th>详细故障描述</th>
									<th id="status" >订单状态</th>
                                    <th>操作</th>
								</tr>
							</thead>
							<!-- 传参处 -->
							<tbody id ="body_son">
								<tr id="1">
									<td id="order_number_1">0000001</td>
									<td>夏逸凡</td>
									<td>进行中</td>
								</tr>
								<tr id="2">
									<td id="order_number_2">0000002</td>
									<td>张霖锋</td>
									<td><a data-target='#take_order' data-toggle='modal' onclick=addSpecificDetail(this.parentNode.parentNode.children[0].innerHTML,this.parentNode.parentNode.children[2].innerHTML)>编辑具体信息</a></td>
								</tr>
							</tbody>
						</table>
<!--					</div>-->
					</div>
				</div>

				<br>

				<!--折叠组-3-->
				<div class="panel panel-success">
					<div class="panel-heading">
						<h4 class="panel-title">
							<a id="Bounded"data-toggle="collapse" data-parent="#accordion"
							   href="#collapseThree">
								已完成订单
							</a>
						</h4>
					</div>
					<div id="collapseThree" class="panel-collapse collapse">
						<table class="table  table-bordered table-hover" id="finished_table"  style="text-align: center; val: middle">
							<!-- 表头 -->
							<thead>
								<tr class="order-form" style="height: 30px">
									<th><label>订单号</label></th>
									<th><label>车牌号</label></th>
									<th><label>车架号</label></th>
									<th><label>车型</label></th>
									<th><label>详细故障描述</label></th>
									<th><label>委托书</label></th>
								</tr>
							</thead>
							<!-- 传参处 -->
							<tbody  id ="body_second">
								<tr class="order-form">
									<td rowspan="2"><h5>0000001</h5></td>
									<td rowspan="2"><h5>12345678901234567</h5></td>

									<td><h5>001</h5></td>
									<td><h5>轮毂</h5></td>
									<td><h5>1</h5></td>

									<!-- <td rowspan="2"><a href="/show_pdf?attorney_no=00000002" target="_blank">查看pdf</a></td> -->
									<td rowspan="2"><a data-toggle='modal' data-target='#detail' style="cursor: pointer; text-decoration-line: underline"><h5>查看pdf</h5></a></td>
								</tr>
								<tr class="order-form">
									<td><h5>002</h5></td>
									<td><h5>后视镜</h5></td>
									<td><h5>2</h5></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>


		</div>

		</div>
	</div>
</div>

<!-- 登出模态框（Modal）-->
<div class='modal fade' id='log_out' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden="true" data-backdrop="static" data-backdrop="static">
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden="true" data-backdrop="static" data-backdrop="static">&times;</button>
				<h3 class='modal-title' id='myModalLabel'>您确定要登出当前账号吗？</h3>
				<h4 class='modal-body' id='text1'></h4>
			</div>
			<form class='modal-footer'>
				<button type='submit' value='退出登录' class='btn btn-primary' onclick='logout()'>退出登录</button>
				<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
			</form>
		</div>
	</div>
</div>


<!--编辑订单信息 -->
<div class='modal fade' id='take_order' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden="true" data-backdrop="static" data-backdrop="static">
	<div class='modal-dialog' style="width: 70%;height: 80%;">
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden="true" data-backdrop="static" data-backdrop="static">&times;</button>
				<h3 class='modal-title' id='takeOrder'>编辑新订单</h3>
			</div>
			<div class='modal-body'>
				<div class='row' style="margin-left: 20px">
					<div class='col-md-6'>
						<div id="order_selection">
							<img src='/statics/user/订单号.png' width='20px' alt="正在加载图片">
							<label for="order_number" style='font-size:15px;width: 80px;'>订单号：</label>
							<input id='order_number' style="width: 150px; color: #9d9d9d" readonly="readonly">
							<br>
						</div>

						<br>
						<img src='/statics/user/井号.png' width='20px' alt="正在加载图片">
						<label for="VehicleNumber" style='font-size:15px;width: 80px;'>车架号：</label>
						<input id='VehicleNumber' type='text' onchange='check_number()' readonly="readonly" value="1111111111111" style="color: #9d9d9d"/>
						<!-- <span id='checktext1'></span> -->
						<br>
						<br>

						<img src='/statics/user/结算方式.png' width='20px' alt="正在加载图片">
						<label style='font-size:15px;width: 80px;'>结算方式：</label>
						<input id='PayMethod1' disabled name="PayMethod" type='radio' value="自付" readonly="readonly"/>
						<label for="PayMethod1">自付</label>
						<input id='PayMethod2' disabled name="PayMethod" type='radio' value="三包" readonly="readonly"/>
						<label for="PayMethod2">三包</label>
						<input id='PayMethod3' disabled name="PayMethod" type='radio' value="索赔" readonly="readonly"/>
						<label for="PayMethod3">索赔</label>
						<!-- <span id='checktext2'></span> -->
						<br>
						<br>

						<img src='/statics/user/进场时间.png' width='20px' alt="正在加载图片">
						<label for="StartTime" style='font-size:15px;width: 80px;'>进场时间：</label>
						<input id="StartTime" readonly="readonly" type="date" min ="2022-01-01" max ="2999-12-31" class="measureDate" placeholder="请选择日期" onblur="dateModify(this.value)" style="color: #9d9d9d">
						<!-- <label for='StartTime'></label><input id='StartTime' type='text'/> -->
						<br>
						<br>

						<div>
							<img src='/statics/user/车辆故障.png' width='20px' style="vertical-align: top" alt="正在加载图片">
							<label for='RoughProblem' style='font-size:15px;width: 80px;vertical-align: top'>粗略故障：</label>
							<textarea id='RoughProblem' readonly="readonly" placeholder='请粗略描述您车辆的故障（字数在255以下）' style="width: 300px;height: 100px; color: #9d9d9d"></textarea>
						</div>
						<br>

						<img src='/statics/user/油量.png' width='20px' alt="正在加载图片">
						<label for="StartPetrol" style='font-size:15px;width: 80px;'>进场油量：</label>
						<input id='StartPetrol' type='number' readonly="readonly" min="0" max="100" step="0.1" placeholder='进场时车辆所剩油量' style="width: 130px; color: #9d9d9d"/> L
						<br>
						<br>

						<img src='/statics/user/里程.png' width='20px' alt="正在加载图片">
						<label for="StartMile" style='font-size:15px;width: 80px;'>进场里程：</label>
						<input id='StartMile' type='number' readonly="readonly" min="0" step="0.1" placeholder='进场时车辆里程数' style="width: 130px; color: #9d9d9d"/> km
						<br>
						<br>
					</div>

					<div class='col-md-6'>
						<div id="time_request">
							<img src='/statics/user/维修类型.png' width='20px' alt="正在加载图片">
							<label style='font-size:15px;width: 80px;'>维修类型：</label>
							<input id='time_request1' name="time_request" type='radio' value="加急" />
							<label for="time_request1">加急</label>
							<input id='time_request2' name="time_request" type='radio' value="普通" checked="checked"/>
							<label for="time_request2">普通</label>
							<br>
						</div>

						<div id="type_selection">
							<img src='/statics/user/维修类型.png' width='20px' alt="正在加载图片">
							<label style='font-size:15px;width: 80px;'>作业分类：</label>
							<input id='repair_type1' name="repair_type" type='radio' value="小型" />
							<label for="repair_type1">小型</label>
							<input id='repair_type2' name="repair_type" type='radio' value="中型" checked="checked"/>
							<label for="repair_type2">中型</label>
							<input id='repair_type3' name="repair_type" type='radio' value="大型" />
							<label for="repair_type3">大型</label>
							<br>
						</div>

						<div id="malfunction_detail">
							<img src='/statics/user/车辆故障.png' width='20px' style="vertical-align: top" alt="正在加载图片">
							<label for='DetailedProblem' style='font-size:15px;width: 80px;vertical-align: top'>详细故障：</label>
							<textarea class="edit_attorney" id='DetailedProblem' placeholder='请详细描述顾客车辆的故障' style="width: 300px;height: 100px;"></textarea>
							<br>
						</div>

						<div id="excluded">
							<img src='/statics/user/车辆故障.png' width='20px' style="vertical-align: top" alt="正在加载图片">
							<label for='RoughProblem' style='font-size:15px;width: 80px;vertical-align: top'>非保修：</label>
							<textarea class="edit_attorney" id='ExcludedParts' placeholder='请填写车辆非保修部分：' style="width: 300px;height: 100px;"></textarea>
							<br>
						</div>

						<br>
						<img src='/statics/user/进场时间.png' width='20px' alt="正在加载图片">
						<label for="ExpectedEndTime" style='font-size:15px;width: 110px;'>预计出厂时间：</label>
						<input id='ExpectedEndTime' type="date" min ="2022-01-01" max ="2999-12-31" class="measureDate edit_attorney" placeholder="请选择日期" onblur="dateModify(this.value)">
						<!-- <label for='StartTime'></label><input id='StartTime' type='text'/> -->
						<br>
						<br>

						<img src='/statics/user/油量.png' width='20px' alt="正在加载图片">
						<label for="EndPetrol" style='font-size:15px;width: 80px;'>出场油量：</label>
						<input class="edit_attorney" id='EndPetrol' type='number' min="0" max="100" step="0.1" placeholder='出场时车辆所剩油量' style="width: 130px"/> L
						<br>
						<br>

						<img src='/statics/user/里程.png' width='20px' alt="正在加载图片">
						<label for="EndMile" style='font-size:15px;width: 80px;'>出场里程：</label>
						<input class="edit_attorney" id='EndMile' type='number' min="0" step="0.1" placeholder='出场时车辆里程数' style="width: 130px"/> km
						<br>
						<br>


					</div>
				</div>

				<div class='row' style="margin-left: 20px">
					<div id="filling_details">
						<img src='/statics/user/详情.png' width='20px' alt="正在加载图片">
						<label style='font-size:15px;width: 90px;'>详情：</label>
						<br>
						<br>
						<div id="detail">
							<div id="fill_project" style="display: inline">
								<label for="project" style='font-size:15px;width: 90px;'>维修项目名：</label>
								<div id="project_input" style="margin-top: 5px;display: inline; width: 90px; position: absolute;">
									<input class="detail" id='project' list="projects" onchange="getProjectTime()" onkeydown="closeFlagProjects()" onkeyup="openFlagProjects()" placeholder='输入维修项目名或首字母：'  type='text'/>
									<div id="projects">
									</div>
								</div>
							</div>

							<label for="classification" style='font-size:15px;width: 60px; margin-left: 150px'>　工种：</label>
							<select id='classification' onchange="getCorrespondingRepairman()">
								<option selected="selected" disabled="disabled"  style='display: none' value=''></option>
								<option>机修工</option>
								<option>电工</option>
								<option>钣金工</option>
								<option>喷漆工</option>
							</select>

							<label for="repairman_name" style='font-size:15px;width: 110px;'>　维修工姓名：</label>
							<select id='repairman_name' style="width: 180px">
								<option selected="selected" disabled="disabled"  style='display: none' value=''></option>
							</select>
							<input class="detail" id="repairman_number" type="text" style="display: none"/>
							<label for="predict_finish_time" style='font-size:15px;width: 70px;'>　工时：</label>
							<input class="detail" id="predict_finish_time" style="width: 50px" readonly/>
							<input class="detail" id="project_number" type="text" style="display: none"/>
							<button id="add_repairman" class='btn btn-primary' onclick="if(checkSubmit('detail'))addProject()" style="margin-left: 20px">添加维修项目</button>
						</div>

						<div style="padding-right: 50px; margin-top: 10px">
							<table id="detailTable" class="table  table-bordered table-hover" >
								<thead>
									<tr class="order-form">
										<th><label>项目号</label></th>
										<th><label>项目名</label></th>
										<th><label>工时</label></th>
										<th><label>工种</label></th>
										<th><label>维修员编号</label></th>
										<th><label>维修员姓名</label></th>
										<th><label>维修状态</label></th>
									</tr>
								</thead>
								<tbody id="detailTableRow">

								</tbody>
							</table>
						</div>



<!--						<div id="detail2">-->
<!--							<label for="project2" style='font-size:15px;width: 90px;'>具体问题：</label>-->
<!--							<input id='project2' type='text' placeholder='具体故障部位'/>-->
<!--							&lt;!&ndash;				<img src='/statics/user/问号.png' width='20px' alt="正在加载图片">&ndash;&gt;-->
<!--							&lt;!&ndash;				<span id='checktext2'></span>&ndash;&gt;-->
<!--							&lt;!&ndash;				<br>&ndash;&gt;-->

<!--							&lt;!&ndash;				<img src='/statics/user/颜色.png' width='20px' alt="正在加载图片">&ndash;&gt;-->
<!--							<label for="classification2" style='font-size:15px;width: 60px;'>　工种：</label>-->
<!--							<select id='classification2'>-->
<!--								<option>机修工</option>-->
<!--								<option>电工</option>-->
<!--								<option>钣金工</option>-->
<!--								<option>喷漆工</option>-->
<!--							</select>-->

<!--							&lt;!&ndash;				<img src='/statics/user/车型.png' width='20px' alt="正在加载图片">&ndash;&gt;-->
<!--							<label for="repairman_name2" style='font-size:15px;width: 115px;'>　维修工姓名：</label>-->
<!--							<select id='repairman_name2'>-->
<!--								<option>奚嘉骏</option>-->
<!--								<option>伍慕庭</option>-->
<!--								<option>夏逸凡</option>-->
<!--								<option>张霖锋</option>-->
<!--							</select>-->

<!--							&lt;!&ndash;				<img src='/statics/user/类别.png' width='20px' alt="正在加载图片">&ndash;&gt;-->
<!--							<label for="predict_finish_time2" style='font-size:15px;width: 120px;'>　预计所需时间：</label>-->
<!--							<input id="predict_finish_time2" type='number' min="0" max="10000" step="0.5" placeholder='预计所需时间' style="width: 130px"/>-->
<!--							<br>-->
<!--						</div>-->
					</div>
				</div>

			</div>
			<form class='modal-footer'>
<!--				<label style='font-size:1px;width: 80px;color: red;'>没有再次确认哦，真的</label>-->
				<button type='button' class='btn btn-primary' onclick="if(checkSubmit('edit_attorney')&&dateModify(document.getElementById('ExpectedEndTime').value))checkOut()" id='checkOutAttorney' style="display: none">结算</button>				、
				<button type='button' class='btn btn-primary' onclick="saveAttorney(true)" id='confirmAddVehicle'>保存编辑</button>
				<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
			</form>
		</div>
	</div>
</div>

<!-- 已完成订单 -->
<!--<div class='modal fade' id='finished_order' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden="true" data-backdrop="static" data-backdrop="static">-->
<!--	<div class='modal-dialog'>-->
<!--		<div class='modal-content'>-->
<!--			<div class='modal-header'>-->
<!--				<button type='button' class='close' data-dismiss='modal' aria-hidden="true" data-backdrop="static" data-backdrop="static" >&times;</button>-->
<!--				<h3 class='modal-title' id='finishedOrder' style="text-align: center">已完成订单</h3>-->
<!--			</div>-->
<!--			<div class='modal-body' id="finished_table_father" style="margin: auto; width: 560px; text-align: center; font-size: 17px;">-->
<!--				&lt;!&ndash;-->
<!--				<table border="1" style="margin: auto; width: 560px; text-align: center; font-size: 17px; ">-->
<!--					<tr>-->
<!--						<th style="text-align: center; width: 70px">车牌号</th>-->
<!--						<th id="finished_plate" style="text-align: center; width: 210px">沪SHU502</th>-->
<!--						<th style="text-align: center; width: 70px">车架号</th>-->
<!--						<th id="finsihed_VIN"style="text-align: center; width: 210px">11111111111111111</th>-->
<!--					</tr>-->
<!--				</table>-->
<!--				&ndash;&gt;-->
<!--				<table id="finished_table" border="1" style="margin: auto; width: 560px; text-align: center; font-size: 17px;">-->
<!--					&lt;!&ndash; 表头 &ndash;&gt;-->
<!--					<tbody>-->
<!--					<tr style="height: 30px">-->
<!--						<th id="number_finished" style="text-align: center; width: 120px">订单号</th>-->
<!--						<th id="vehicle_number_finished" style="text-align: center">车架号</th>-->
<!--						<th id="parts_number_finished" style="text-align: center">粗略故障描述</th>-->
<!--						<th id="parts_name_finished" style="text-align: center">详细故障描述</th>-->
<!--						<th id="parts_count_finished" style="text-align: center">维修完成时间</th>-->
<!--						<th id="finished_detail" style="text-align: center">委托书</th>-->
<!--					</tr>-->
<!--					</tbody>-->
<!--					&lt;!&ndash; 传参处 &ndash;&gt;-->
<!--					<tbody id ="body_second">-->
<!--					<tr>-->
<!--						<td rowspan="2">0000001</td>-->
<!--						<td rowspan="2">12345678901234567</td>-->

<!--						<td>001</td>-->
<!--						<td>轮毂</td>-->
<!--						<td>1</td>-->

<!--						&lt;!&ndash; <td rowspan="2"><a href="/show_pdf?attorney_no=00000002" target="_blank">查看pdf</a></td> &ndash;&gt;-->
<!--						<td rowspan="2"><a data-toggle='modal' data-target='#detail' style="cursor: pointer; text-decoration-line: underline">查看pdf</a></td>-->
<!--					</tr>-->
<!--					<tr>-->
<!--						<td>002</td>-->
<!--						<td>后视镜</td>-->
<!--						<td>2</td>-->
<!--					</tr>-->
<!--					</tbody>-->
<!--				</table>-->
<!--			</div>-->
<!--		</div>-->
<!--	</div>-->
<!--</div>-->

<!-- 更改折扣率 -->
<div class="modal fade" id="discountRate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" data-backdrop="static">&times;</button>
				<h3 class="modal-title" id="changeDiscountRate">更改折扣率</h3>
			</div>
			<div class="modal-body">
				<img src='/statics/user/折扣.png' width='20px' alt="正在加载图片">
				<label for="discount_rate" style='font-size:15px;width: 80px;'>折 扣 率：</label>
				<input id='discount_rate' type='number' min="70" step="5" max="100" value='100'/> %
				<br>
			</div>
			<form class="modal-footer">
				<button type="button" class="btn btn-primary" id="confirmDiscountChange" onclick="updateDiscountRate()">确认更改</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
			</form>
		</div>
	</div>
</div>

<!-- 更改密码 -->
<div class='modal fade' id='change_password' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden="true" data-backdrop="static" data-backdrop="static" onkeydown="keychangepassword()">
	<div class='modal-dialog'>
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden="true" data-backdrop="static" data-backdrop="static">&times;</button>
				<h3 class='modal-title' id='changePSWD'>更改密码</h3>
			</div>
			<div class='modal-body'>
				<img src='/statics/user/旧密码.png' width='20px' alt="正在加载图片">
				<label for="oldpswd" style='font-size:15px;width: 80px;'>原密码：</label>
				<input id='oldpswd' type='password' name="oldpswd" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext3'></span> <br></br>

				<img src='/statics/user/新密码.png' width='20px' alt="正在加载图片">
				<label for="pswd" style='font-size:15px;width: 80px;'>密码：</label>
				<input id='pswd' type='password' name="pswd" onchange="checkpwd()" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext4'></span> <br></br>

				<img src='/statics/user/重复密码.png' width='20px' alt="正在加载图片">
				<label for="pwdc" style='font-size:15px;width: 80px;'>确认密码：</label>
				<input id='pwdc' type='password' name="pwdc" onchange="checkpwdc()" onpaste="return false" onkeydown="if(event.keyCode==32) return false"/>
				<span id='checktext5'></span> <br></br>

				<input type="hidden" id="old_password" name="old_password" />
				<input type="hidden" id="new_password" name="new_password" />
				<form class='modal-footer'>
					<button type='button' class='btn btn-primary' onclick='check()' id='changepasswordbutton'>确认更改</button>
					<button type='button' class='btn btn-default' data-dismiss='modal'>取消</button>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- 显示pdf -->
<div class='modal fade' id='pdf' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden="true" data-backdrop="static" data-backdrop="static" >
	<div class='modal-dialog' style="width: 80%;height: 80%;">
		<div class='modal-content'>
			<div class='modal-header'>
				<button type='button' class='close' data-dismiss='modal' aria-hidden="true" data-backdrop="static" data-backdrop="static">&times;</button>
			</div>
			<div class='modal-body'>
				<div id="pdf_div" style="text-align: center;">
					<embed height="840px" id="show_pdf" src="/show_pdf?attorney_no=00000001" width="90%" />
				</div>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">
	window.onload= function(){
		getUserName();
		salesmanInfo();
		showNotificationOrNot();
		getProcessingAttorney();
		ongoingNumber();
		getPendingAttorney();
		getFinishedAttorney();
	}

	function fill(source){
			document.getElementById("project").value = source.innerHTML;
			document.getElementById("project_number").value = source.id;
			getProjectTime();
			delProjectResults();
	}

	function salesmanInfo(){
		axios({
			method : 'get',
			url: "/get_salesman_info"
		})
				.then(function(response){
					var last = response.data;
					document.getElementById("number").innerHTML = "工　　号：" + last.Number;
					document.getElementById("number").class = last.Number;
					document.getElementById("salesman_name").innerHTML = "姓　　名：" + last.Name;
				})
	}

	function ongoingNumber(){
		axios({
			method : 'get',
			url: "/get_relating_attorney"
		})
				.then(function (response) {
					var data = response.data;
					var prebound_num = data.Pending.length;
					var onbound_num = data.Processing.length;
					var bounded_num = data.Finished.length;
					document.getElementById("preBound").innerHTML = "待接订单" + "(" + prebound_num + ")";
					document.getElementById("onBound").innerHTML = "进行中订单" + "(" + onbound_num + ")";
					document.getElementById("Bounded").innerHTML = "已完成订单" + "(" + bounded_num + ")";
				})
	}

	function showOptions(){
		var option_list = document.getElementById("projectOptions");
		option_list.style.display="inline";
	}

	function getPendingAttorney(){
        //删除表格
		try {
			document.getElementById("pending_table").removeChild(document.getElementById("pending_table_son"))
		} catch(error){}
		//建立表格
		var tbody = document.createElement("tbody");
		document.getElementById("pending_table").appendChild(tbody);
		tbody.id = "pending_table_son";
		axios({
			method : 'get',
			url: "/get_relating_attorney"
		})
				.then(function (response) {
					var data = response.data;
					var own = data.Pending;
					var num = own.length;
					if(num === 0){
						var tr = document.createElement("tr");
						tbody.appendChild(tr);
						var td1 = document.createElement("td");
						tr.appendChild(td1);
						td1.innerHTML = "暂时没有新的订单供接单...";
						td1.setAttribute("colspan", "6");
					}
					else{
						for(var i = 0; i < num; i++){
							var tr = document.createElement("tr");
							tbody.appendChild(tr);
							var td1 = document.createElement("td");
							tr.appendChild(td1);
							var h51 = document.createElement("h5");
							td1.appendChild(h51);
							h51.innerHTML = own[i].Number;
							var td2 = document.createElement("td");
							tr.appendChild(td2);
							var h52 = document.createElement("h5");
							td2.appendChild(h52);
							h52.innerHTML = own[i].Plate;
							var td3 = document.createElement("td");
							tr.appendChild(td3);
							var h53 = document.createElement("h5");
							td3.appendChild(h53);
							h53.innerHTML = own[i].Vin;
							var td4 = document.createElement("td");
							tr.appendChild(td4);
							var h54 = document.createElement("h5");
							td4.appendChild(h54);
							h54.innerHTML = own[i].CarModel;
							var td5 = document.createElement("td");
							tr.appendChild(td5);
							var h55 = document.createElement("h5");
							td5.appendChild(h55);
							h55.innerHTML = own[i].RoughProblem;
							var td6 = document.createElement("td");
							tr.appendChild(td6);
							var a = document.createElement("button");
							td6.appendChild(a);
							a.innerHTML = "接单！！！";
							a.setAttribute("class", "btn btn-primary");
							a.setAttribute("type", "button");
							var span = document.createElement("span");
							span.setAttribute("class","glyphicon");
							a.appendChild(span);
							a.setAttribute("onclick","takeOrder(\""+own[i].Number+"\")");
							tr.setAttribute("class","order-form");
						}
					}
				})
	}

	function getProcessingAttorney(){
		//删除表格
		try {document.getElementById("ongoing_table").removeChild(document.getElementById("body_son"))}
		catch(error){}
		//建立表格
		var tbody = document.createElement("tbody");
		document.getElementById("ongoing_table").appendChild(tbody);
		tbody.id = "body_son";
		axios({
			method : 'get',
			url: "/get_relating_attorney"
		})
				.then(function (response) {
					var data = response.data;
					var own = data.Processing;
					var num = own.length;
					if(num === 0){
						var tr = document.createElement("tr");
						tbody.appendChild(tr);
						tr.setAttribute("class", "order-form");

						var td1 = document.createElement("td");
						tr.appendChild(td1);
						td1.innerHTML = "-";

						var td2 = document.createElement("td");
						tr.appendChild(td2);
						td2.innerHTML = "-";

						var td3 = document.createElement("td");
						tr.appendChild(td3);
						td3.innerHTML = "-";

						var td4 = document.createElement("td");
						tr.appendChild(td4);
						td4.innerHTML = "-";

						var td5 = document.createElement("td");
						tr.appendChild(td5);
						td5.innerHTML = "-";

						var td6 = document.createElement("td");
						tr.appendChild(td6);
						td6.innerHTML = "-";

						var td7 = document.createElement("td");
						tr.appendChild(td7);
						td7.innerHTML = "-";
						var td8 = document.createElement("td");
						tr.appendChild(td8);
						td8.innerHTML = "-";
						var a = document.createElement("button");
					}
					else{
						for(var i = 0; i < num; i++){
							var tr = document.createElement("tr");
							tbody.appendChild(tr);
							tr.setAttribute("class", "order-form");

							var td1 = document.createElement("td");
							tr.appendChild(td1);
							td1.id = "order_number_" + i;;
							td1.innerHTML = own[i].Number;
							var car_type = own[i].CarType[3];

							var td2 = document.createElement("td");
							tr.appendChild(td2);
							td2.id = "order_type_" + i;
							td2.innerHTML = own[i].Plate;

							var td3 = document.createElement("td");
							tr.appendChild(td3);
                            td3.id = "order_type_" + i;
                            td3.innerHTML = own[i].Vin;

                            var td4 = document.createElement("td");
                            tr.appendChild(td4);
                            td4.id = "order_type_" + i;
                            td4.innerHTML = own[i].CarModel;

                            var td5 = document.createElement("td");
                            tr.appendChild(td5);
                            td5.id = "order_type_" + i;
                            td5.innerHTML = own[i].RoughProblem;

                            var td6 = document.createElement("td");
                            tr.appendChild(td6);
                            td6.id = "order_type_" + i;
                            td6.innerHTML = own[i].SpecificProblem;

                            var td7 = document.createElement("td");
                            tr.appendChild(td7);
                            var progress = own[i].Progress;
                            td7.innerHTML = progress;
                            // alert(own[i].Progress);
							// if(own[i].Progress === "待结算"){
							// 	// td7.innerHTML = own[i].Progress;
                            //     var a = document.createElement("a");
                            //     td7.appendChild(a);
                            //     a.setAttribute("data-toggle", "modal");
                            //     a.setAttribute("data-target", "#discountRate");
                            //     a.setAttribute("onclick", "");
                            //     a.setAttribute("style", "cursor:pointer");
                            //     // a.setAttribute("onclick", "addSpecificDetail(\""+td1.id+"\",\""+td2.id+"\")");
                            //     a.innerHTML = "待结算";
							// }
                            var td8 = document.createElement("td");
                            tr.appendChild(td8);
                            var a = document.createElement("button");
                            td8.appendChild(a);
                            a.setAttribute("data-toggle", "modal");
                            a.setAttribute("data-target", "#take_order");
							// alert(progress);
                            a.setAttribute("onclick", "addSpecificDetail(this.parentNode.parentNode.children[0].innerHTML,\""+car_type+"\",this.parentNode.parentNode.children[6].innerHTML)");
                            a.setAttribute("class", "btn btn-primary");
							a.setAttribute("type", "button");
                            // a.setAttribute("onclick", "addSpecificDetail(\""+td1.id+"\",\""+td2.id+"\")");
                            a.innerHTML = "编辑具体信息";

						}
					}
				})
	}

	function getFinishedAttorney(){
		//删除表格
		try {document.getElementById("finished_table").removeChild(document.getElementById("body_second"))}
		catch(error){}
		//建立表格
		var tbody = document.createElement("tbody");
		document.getElementById("finished_table").appendChild(tbody);
		tbody.id = "body_second";
		axios({
			method : 'get',
			url: "/get_relating_attorney"
		})
				.then(function (response) {
					var data = response.data;
					var own = data.Finished;
					var num = own.length;
					if(num === 0){
						var tr = document.createElement("tr");
						tbody.appendChild(tr);
						var td = document.createElement("td");
						tr.appendChild(td);
						td.innerHTML = " 　";
						var td1 = document.createElement("td");
						tr.appendChild(td1);
						var td2 = document.createElement("td");
						tr.appendChild(td2);
						var td3 = document.createElement("td");
						tr.appendChild(td3);
						var td4 = document.createElement("td");
						tr.appendChild(td4);
						var td5 = document.createElement("td");
						tr.appendChild(td5);
						var td6 = document.createElement("td");
						tr.appendChild(td6);
					}
					else{
						for(var i = 0; i < num; i++) {
							var tr = document.createElement("tr");
							tbody.appendChild(tr);
							var td1 = document.createElement("td");
							tr.appendChild(td1);
							var h51 = document.createElement("h5");
							td1.appendChild(h51);
							h51.innerHTML = own[i].Number;
							var td2 = document.createElement("td");
							tr.appendChild(td2);
							var h52 = document.createElement("h5");
							td2.appendChild(h52);
							h52.innerHTML = own[i].Plate;
							var td3 = document.createElement("td");
							tr.appendChild(td3);
							var h53 = document.createElement("h5");
							td3.appendChild(h53);
							h53.innerHTML = own[i].Vin;
							var td4 = document.createElement("td");
							tr.appendChild(td4);
							var h54 = document.createElement("h5");
							td4.appendChild(h54);
							h54.innerHTML = own[i].CarModel;
							var td6 = document.createElement("td");
							tr.appendChild(td6);
							var h56 = document.createElement("h5");
							td6.appendChild(h56);
							h56.innerHTML = own[i].SpecificProblem;
							var td7 = document.createElement("td");
							tr.appendChild(td7);
							var h57 = document.createElement("button");
							td7.appendChild(h57);
							h57.setAttribute("data-toggle","modal");
							h57.setAttribute("data-target","#pdf");
							h57.setAttribute("class", "btn btn-primary");
							h57.setAttribute("type", "button")
							h57.setAttribute("onclick","loadPDF(this)");
							h57.innerHTML = "查看委托书";
							var h58 = document.createElement("button");
							td7.appendChild(h58);
							h58.setAttribute("class", "btn btn-primary");
							h58.setAttribute("type", "button")
							h58.setAttribute("onclick","downloadPDF(this)");
							tr.setAttribute("class","order-form");
							h58.innerHTML = "下载委托书";
						}
					}
				})
	}

	function getFinishedAttorneyS() {
		//删表
		try {
			document.getElementById("finished_table").removeChild(document.getElementById("body_second"))
		} catch (error) {
		}
		//建表
		axios({
			method: 'get',
			url: "/get_finished_attorney_s"
		})
				.then(function (response) {
					data = response.data;
					num = data.length;
					var tbody = document.createElement("tbody");
					tbody.id = "body_second";
					document.getElementById("finished_table").appendChild(tbody);
					if (num === 0) {
						var tr = document.createElement("tr");
						tbody.appendChild(tr);
						var td1 = document.createElement("td");
						tr.appendChild(td1);
						td1.innerHTML = " 　";
						var td2 = document.createElement("td");
						tr.appendChild(td2);
						var td3 = document.createElement("td");
						tr.appendChild(td3);
						var td4 = document.createElement("td");
						tr.appendChild(td4);
						var td5 = document.createElement("td");
						tr.appendChild(td5);
						var td6 = document.createElement("td");
						tr.appendChild(td6);
					}
					else {
						for (var i = 0; i < num; i++) {
							var tr = document.createElement("tr");
							tbody.appendChild(tr);
							var td1 = document.createElement("td");
							tr.appendChild(td1);
							td1.innerHTML = data[i].OrderNumber;
							var td2 = document.createElement("td");
							tr.appendChild(td2);
							td2.innerHTML = data[i].Vin
							var td3 = document.createElement("td");
							tr.appendChild(td3);
							td3.innerHTML = data[i].RoughProblem;
							var td4 = document.createElement("td");
							tr.appendChild(td4);
							td4.innerHTML = data[i].SpecificProblem;
							var td5 = document.createElement("td");
							tr.appendChild(td5);
							td5.innerHTML = data[i].PredictFinishTime;
							var td6 = document.createElement("td");
							tr.appendChild(td6);
							td6.innerHTML = "<font color=#0000FF><u>查看pdf</u></font>";
							td6.setAttribute("style", "cursor:pointer");
							td6.setAttribute("onclick", "window.open('/show_pdf?attorney_no=" + data[i].OrderNumber + "&user_id=" + data[i].Username + "')");
						}
					}
				})
	}

	function getCorrespondingRepairman(){
		try{ $("#repairman_name").empty()
		} catch(error){}
		axios({
			method: 'get',
			url: '/get_corresponding_repairman?type=' + document.getElementById("classification").value
		})
				.then(function (response) {
					var num = response.data.length;
					for(var i = 0; i < num; i++){
						var option = document.createElement("option");
						document.getElementById("repairman_name").appendChild(option);
						document.getElementById("repairman_number").value = response.data[i].Number;
						option.innerHTML = response.data[i].Name + "（当前工时：" + response.data[i].CurrentWorkHour + "）";
					}
				})
	}

    function takeOrder(param){
		let formData = new FormData();
		formData.append("attorney_no", param);
		let config = {
			headers: {"Content-Type": "multipart/form-data"}
		};
		axios.post("/receive_attorney", formData, config).then(res => {
			res = res.data;
			alert(res.data);
			if(res.status === "成功"){
				location.reload();
			}
		})
	}

	// 根据订单号查询订单的详细信息
	function addSpecificDetail(attorneyNo, type, Progress){
		document.getElementById("project").value ="";
		document.getElementById("classification").value ="";
		document.getElementById("repairman_name").value ="";
		document.getElementById("predict_finish_time").value = 0;
		axios({
			method: 'get',
			url: '/get_full_attorney_s?attorney_no=' + attorneyNo
		})
				.then(function (response) {
					var order_number = document.getElementById('order_number');
					order_number.value = attorneyNo;
					order_number.class = type;
					res = response.data;
					// alert(res.VehicleVin);
					var input = document.getElementById('VehicleNumber')
					input.value = res.VehicleVin;
					// alert(res.PayMethod);
					var selections = document.getElementsByName('PayMethod');
					for(var i = 0; i < 3; i++){
						if(selections[i].value === res.PayMethod){
							selections[i].setAttribute("checked", "checked");
							break;
						}
					}
					var date = document.getElementById("StartTime");
					date.value = res.StartTime;
					var roughProblem = document.getElementById('RoughProblem');
					roughProblem.value = res.RoughProblem;
					var startPetrol = document.getElementById('StartPetrol');
					startPetrol.value = res.StartPetrol;
					var startMile = document.getElementById('StartMile');
					startMile.value = res.StartMile;

					var repairTypes1 = document.getElementsByName('time_request');
					for(var j = 0; j < 2; j++){
						if(repairTypes1[j].value === res.RepairType){
							repairTypes1[j].checked = "checked";
							break;
						}
					}
					var repairTypes2 = document.getElementsByName('repair_type');
					for(var k = 0; k < 3; k++){
						if(repairTypes2[k].value === res.RepairClassification){
							repairTypes2[k].checked = "checked";
							break;
						}
					}
					var detailMalfunction = document.getElementById('DetailedProblem');
					detailMalfunction.value = res.SpecificProblem;
					var excluded = document.getElementById('ExcludedParts');
					excluded.value = res.OutRange;
					var expectedEndTime = document.getElementById('ExpectedEndTime');
					expectedEndTime.value = res.PredictFinishTime

					var endPetrol = document.getElementById('EndPetrol');
					endPetrol.value = res.EndPetrol;
					if(res.EndPetrol === 0){
						endPetrol.value = "";
					}
					var endMile = document.getElementById('EndMile');
					endMile.value = res.EndMile;
					if(res.EndMile === 0){
						endMile.value = "";
					}

                    if (Progress === "待结算"){
						// checkout_string = "checkOut(" + attorneyNo + ")";
                        var btn = document.getElementById('checkOutAttorney');
                        btn.setAttribute("style", "display: inline");
						btn.setAttribute("onclick", "if(checkSubmit('edit_attorney')&&dateModify(document.getElementById('ExpectedEndTime').value))checkOut('" + attorneyNo + "')");
                    }
				})
		getProjects(attorneyNo);
	}

	function getCustomerInfo(){
		axios({
			method: 'get',
			url: '/get_full_attorney_s?attorney_no=' + document.getElementById("order_number_0").value
		})
	}

	// 点击加号图案后将项目送到库中
	function addProject(){
		var attorney_no = document.getElementById("order_number").value;
		//向数据库发送项目信息
		var project_no = document.getElementById("project_number").value;
		var repairman_no = document.getElementById("repairman_number").value;
		let formData = new FormData();
		formData.append("attorney_no", attorney_no);
		formData.append("project_no", project_no);
		formData.append("repairman_no", repairman_no);
		let config = {
			headers: {"Content-Type": "multipart/form-data"}
		};
		axios.post("/add_project_for_attorney", formData, config).then(res => {
			if(res.data.status === "错误")
				alert("添加失败！错误信息：" + res.data.data.Message);
			else
				alert("添加成功！");
		});
		document.getElementById("project").value ="";
		document.getElementById("classification").value ="";
		document.getElementById("repairman_name").value ="";
		document.getElementById("predict_finish_time").value ="";
		getProjects(attorney_no);
	}

	// 根据订单号从库中返回项目
	function getProjects(attorney_no) {
		try{document.getElementById("detailTable").removeChild(document.getElementById("detailTableRow"))
		} catch(error){}
		let table = document.getElementById("detailTable");
		let tbody = document.createElement("tbody");
		tbody.setAttribute("id", "detailTableRow");
		table.appendChild(tbody);
		axios({
			method: 'get',
			url: '/get_arrangements?attorney_no='+ attorney_no
		})
				.then(function (response) {
					let data = response.data;
					for (let i = 0; i < data.length; i++) {
						let arrangement = data[i];
						let project_number = arrangement.ProjectNumber;
						let project_name = arrangement.ProjectName;
						let project_time = arrangement.ProjectTime;
						let repairmen = arrangement.Repairman;

						let tr = document.createElement("tr");
						tr.setAttribute("class", "order-form");
						tbody.appendChild(tr);

						let td1 = document.createElement("td");
						tr.appendChild(td1);
						td1.innerHTML = project_number;
						td1.setAttribute("rowspan",repairmen.length);

						let td2 = document.createElement("td");
						tr.appendChild(td2);
						td2.innerHTML = project_name;
						td2.setAttribute("rowspan",repairmen.length);

						let td3 = document.createElement("td");
						tr.appendChild(td3);
						td3.innerHTML = project_time;
						td3.setAttribute("rowspan",repairmen.length);

						let td4 = document.createElement("td");
						tr.appendChild(td4);
						td4.innerHTML = repairmen[0].Type;

						let td5 = document.createElement("td");
						tr.appendChild(td5);
						td5.innerHTML = repairmen[0].Number;

						let td6 = document.createElement("td");
						tr.appendChild(td6);
						td6.innerHTML = repairmen[0].Name;

						let td7 = document.createElement("td");
						tr.appendChild(td7);
						td7.innerHTML = "<b>"+repairmen[0].Progress+"</b>";
						if(repairmen[0].Progress === "待确认"){
							td7.setAttribute("style","color: #8a6d3b")
						}else if(repairmen[0].Progress === "维修中"){
							td7.setAttribute("style","color: #31708f")
						}else{
							td7.setAttribute("style","color: #3c763d")
						}

						for (let j = 1; j < repairmen.length; j++) {
							let repairman = repairmen[j];
							let type = repairman.Type;
							let number = repairman.Number;
							let name = repairman.Name;
							let progress = repairman.Progress;

							let tr = document.createElement("tr");
							tr.setAttribute("class", "order-form");
							tbody.appendChild(tr);

							let td4 = document.createElement("td");
							tr.appendChild(td4);
							td4.innerHTML = type;

							let td5 = document.createElement("td");
							tr.appendChild(td5);
							td5.innerHTML = number;

							let td6 = document.createElement("td");
							tr.appendChild(td6);
							td6.innerHTML = name;

							let td7 = document.createElement("td");
							tr.appendChild(td7);
							td7.innerHTML = "<b>"+progress+"</b>";
							if(progress === "待确认"){
								td7.setAttribute("style","color: #8a6d3b")
							}else if(progress === "维修中"){
								td7.setAttribute("style","color: #31708f")
							}else{
								td7.setAttribute("style","color: #3c763d")
							}
						}

					}
				})
	}

	function saveAttorney(param){
		let formData = new FormData();
		formData.append("attorney_no", document.getElementById("order_number").value);
		var selections1 = document.getElementsByName('time_request');
		for(var i = 0; i < 2; i++){
			if(selections1[i].checked){
				formData.append("repair_type", selections1[i].value);
				break;
			}
		}
		var selections2 = document.getElementsByName('repair_type');
		for(var j = 0; j < 3; j++){
			if(selections2[j].checked){
				formData.append("repair_classification", selections2[j].value);
				break;
			}
		}
		formData.append("specific_problem", document.getElementById("DetailedProblem").value);
		formData.append("out_range", document.getElementById("ExcludedParts").value);
		formData.append("predict_finish_time", document.getElementById("ExpectedEndTime").value);
		formData.append("end_petrol", document.getElementById("EndPetrol").value);
		formData.append("end_mile",  document.getElementById("EndMile").value);
		let config = {
			headers: {"Content-Type": "multipart/form-data"}
		};
		axios.post("/save_attorney", formData, config).then(res => {
			if(param){
				alert(res.data);
			}
		})
	}

	function dateModify(param){
		if(param === ""){
			alert("日期不合法");
			document.getElementById("StartTime").value = "";
			return false;
		}
		else{
			var year = param[0] + param[1] + param[2] + param[3];
			year = parseInt(year);
			var month = param[5] + param[6];
			month = parseInt(month);
			var date = param[8] + param[9];
			date = parseInt(date);
			if(year < 2022 ){
				document.getElementById("ExpectedEndTime").value = "2022-01-01";
			}
			else if(year > 2999 ){
				document.getElementById("ExpectedEndTime").value = "2099-12-31";
			}
			if(month === 4 || month === 6 || month === 9 || month === 11){
				if(date === 31){
					document.getElementById("ExpectedEndTime").value = param[0] + param[1] + param[2] + param[3] + param[4] + param[5] + param[6] + param[7] + "30";
				}
			}
			return true;
		}
	}

	// 在结算订单时更新折扣率
	function updateDiscountRate(attorney_no, user_id) {

		var finalDiscountRate = document.getElementById('discount_rate').value;
		let formData = new FormData();
		formData.append("attorney_no", attorney_no);
		formData.append("discount_rate", finalDiscountRate);
		formData.append("user_id", user_id);
		let config = {
			headers: {"Content-Type": "multipart/form-data"}
		};
		axios.post("/change_discount_rate", formData, config).then(res => {
			alert(res.data);
			location.reload();
		})
	}

    // 结算
	function checkOut(param) {
		//alert(param);
		if(checkSubmit(param)) {
			saveAttorney(false);
			let formData = new FormData();
			formData.append("attorney_no", param);
			let config = {
				headers: {"Content-Type": "multipart/form-data"}
			};
			axios.post("/set_attorney_finished", formData, config).then(res => {
				var data = res.data;
				window.open(data.url, "_blank");
				discountRate = data.discountRate;
				user_id = data.user_id;

				var originalDiscountRate = document.getElementById('discount_rate');
				originalDiscountRate.value = discountRate;
				var confirmButton = document.getElementById('confirmDiscountChange');
				// alert("updateDiscountRate(" + param + ", " + user_id + ")");
				u_attribute = "updateDiscountRate('" +param + "', \"" + user_id + "\")";
				confirmButton.setAttribute("onclick", u_attribute);
			})
			$('#discountRate').modal("show");
		}
    }
	function showNotificationOrNot() {
		axios({
			method: 'get',
			url: '/check_notification'
		})
				.then(function (response) {
					var last = response.data;
					if(last !== null){
						document.getElementById("notification").style.display = "";
					}
					else{
						document.getElementById("notification").style.display = "none";
					}
				})
	}

	// var EventUtil = {
	// 	on:function(elem,type,handler){
	// 		if(elem.addEventListener){
	// 			elem.addEventListener(type,handler,false);
	// 		}else if(elem.attachEvent){
	// 			elem.attachEvent("on"+type,handler);
	// 		}
	// 	},
	// 	getEvent:function(event){
	// 		return event||window.event;
	// 	},
	// 	getTarget:function(event){
	// 		return event.target||event.srcElement;
	// 	},
	// 	getCharCode:function(event){
	// 		if(typeof event.handler == "number"){
	// 			return event.charCode;
	// 		}else{
	// 			return event.keyCode;
	// 		}
	// 	}
	// }
	// function stopPropagation(e){
	// 	e = window.event||e;
	// 	if(document.all){
	// 		e.cancelBubble = true;
	// 	}else{
	// 		e.stopPropagation();
	// 	}
	// }
	//
	// var input = document.getElementById('detail1');
	// var datalist = document.getElementById('datalist');
	// var list_array = ['aa','aab','abc'];
	//
	// function generatelist(array){
	// 	var _innerHTML = '';
	// 	for (var i = 0; i < array.length; i++) {
	// 		_innerHTML += '<li>'+array[i]+'</li>';
	// 	}
	// 	datalist.innerHTML = _innerHTML;
	// }
	//
	//
	// function findInArray(s){
	// 	var filter_array = [];
	// 	if(s!==''){
	// 		for (var i = 0; i < list_array.length; i++) {
	// 			if(list_array[i].indexOf(s)===0){
	// 				filter_array.push(list_array[i])
	// 			}
	// 		}
	// 	}
	// 	return filter_array;
	// }
	//
	// input.onkeyup = function(){
	// 	var new_array = findInArray(this.value);
	// 	generatelist(new_array);
	// 	if(new_array.length>0){
	// 		setTimeout(function(){datalist.style.visibility = 'visible';},0);
	// 	}else{
	// 		setTimeout(function(){datalist.style.visibility = 'hidden';},0);
	// 	}
	// }
	//
	// EventUtil.on(document.body,'click',function(e){
	// 	stopPropagation(e);
	// 	if(EventUtil.getTarget(e).nodeName==='BODY'){
	// 		datalist.style.visibility = 'hidden';
	// 		datalist.innerHTML ='';
	// 	}
	// 	if(EventUtil.getTarget(e).nodeName === "LI"){
	// 		input.value = EventUtil.getTarget(e).innerHTML;
	// 		datalist.style.visibility = 'hidden';
	// 		datalist.innerHTML ='';
	// 	}
	// })
</script>
</body>
</html>

